.PHONY: run dev build test test-coverage deps clean fmt lint docker-build docker-run migrate-create migrate-up migrate-down

# Development
run:
	@echo "ğŸš€ Starting server..."
	go run cmd/server/main.go

dev:
	@echo "ğŸ”¥ Starting with hot reload..."
	air

# Build
build:
	@echo "ğŸ”¨ Building application..."
	go build -o bin/server cmd/server/main.go

# Database Migration
migrate-create:
	@read -p "Enter migration name: " name; \
	go run cmd/migrate/main.go $$name

migrate-up:
	@echo "ğŸ“Š Running migrations..."
	go run cmd/server/main.go -migrate

migrate-down:
	@echo "âª Rolling back migrations..."
	@read -p "Enter migration ID to rollback to: " id; \
	go run cmd/server/main.go -rollback=$$id

# Testing
test:
	@echo "ğŸ§ª Running tests..."
	go test ./...

test-coverage:
	@echo "ğŸ“Š Running tests with coverage..."
	go test -coverprofile=coverage.out ./...
	go tool cover -html=coverage.out

# Utilities
deps:
	@echo "ğŸ“¦ Installing dependencies..."
	go mod tidy
	go mod download

clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	rm -rf bin/
	rm -rf tmp/
	go clean

fmt:
	@echo "ğŸ¨ Formatting code..."
	go fmt ./...

lint:
	@echo "ğŸ” Running linter..."
	golangci-lint run

# Docker
docker-build:
	@echo "ğŸ³ Building Docker image..."
	docker build -t kuku-yipyerm-backend .

docker-run:
	@echo "ğŸ³ Running Docker container..."
	docker run -p 8080:8080 kuku-yipyerm-backend
